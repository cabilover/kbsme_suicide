# 하이퍼파라미터 튜닝 실험 설정 파일
# Optuna 기반 하이퍼파라미터 최적화

# 실험 설정
experiment:
  name: "hyperparameter_tuning_experiment"
  description: "Optuna 기반 하이퍼파라미터 최적화 실험"
  tags:
    - "hyperparameter_tuning"
    - "optuna"
    - "optimization"

# 튜닝 기본 설정
tuning:
  direction: "maximize"  # "maximize" 또는 "minimize"
  n_trials: 500  # 튜닝 횟수, 500회로 증가
  n_jobs: 4  # 병렬 처리 설정 (안전한 값으로 조정)
  
  # 조기 종료 설정
  early_stopping:
    enabled: true
    patience: 50  # 50번 연속 개선 없으면 조기 종료
    min_trials: 100  # 최소 100번은 시도

# Optuna Sampler 설정
sampler:
  type: "tpe"  # "tpe", "random", "cmaes", "nsgaii", "qmc"
  
  # TPE 설정
  tpe:
    n_startup_trials: 10  # 초기 랜덤 시도 횟수
    n_ei_candidates: 24   # EI 계산 후보 수
    multivariate: true    # 다변량 TPE 사용
    group: false          # 그룹화된 파라미터 지원 (XGBoost 충돌 방지)
  
  # CMA-ES 설정
  cmaes:
    x0:  # 초기 중앙값
      n_estimators: 100
      max_depth: 6
      learning_rate: 0.1
      subsample: 0.8
      colsample_bytree: 0.8
      min_child_weight: 1
      reg_alpha: 0.1
      reg_lambda: 1.0
    sigma0: 0.1  # 초기 표준편차

# XGBoost 하이퍼파라미터 검색 범위
xgboost_params:
  n_estimators:
    type: "int"
    low: 50
    high: 1000
    log: false
  
  max_depth:
    type: "int"
    low: 3
    high: 15
    log: false
  
  learning_rate:
    type: "float"
    low: 0.01
    high: 0.3
    log: true
  
  subsample:
    type: "float"
    low: 0.6
    high: 1.0
    log: false
  
  colsample_bytree:
    type: "float"
    low: 0.6
    high: 1.0
    log: false
  
  colsample_bylevel:
    type: "float"
    low: 0.6
    high: 1.0
    log: false
  
  min_child_weight:
    type: "int"
    low: 1
    high: 10
    log: false
  
  gamma:
    type: "float"
    low: 0.1
    high: 5.0
    log: true
  
  max_delta_step:
    type: "int"
    low: 0
    high: 10
    log: false
  
  reg_alpha:
    type: "float"
    low: "1e-8"
    high: 10.0
    log: true
  
    reg_lambda:
    type: "float"
    low: "1e-8"
    high: 10.0
    log: true

  scale_pos_weight:
    type: "float"
    low: 50.0
    high: 1000.0
    log: true

  tree_method:
    type: "categorical"
    choices: ["auto", "exact", "approx", "hist"]

# LightGBM 하이퍼파라미터 검색 범위
lightgbm_params:
  n_estimators:
    type: "int"
    low: 50
    high: 1000
    log: false
  
  max_depth:
    type: "int"
    low: 3
    high: 12
    log: false
  
  num_leaves:
    type: "int"
    low: 10
    high: 200
    log: false
  
  learning_rate:
    type: "float"
    low: 0.01
    high: 0.3
    log: true
  
  subsample:
    type: "float"
    low: 0.6
    high: 1.0
    log: false
  
  colsample_bytree:
    type: "float"
    low: 0.6
    high: 1.0
    log: false
  
  feature_fraction:
    type: "float"
    low: 0.6
    high: 1.0
    log: false
  
  bagging_fraction:
    type: "float"
    low: 0.6
    high: 1.0
    log: false
  
  bagging_freq:
    type: "int"
    low: 0
    high: 10
    log: false
  
  min_data_in_leaf:
    type: "int"
    low: 10
    high: 100
    log: false
  
  min_child_weight:
    type: "int"
    low: 1
    high: 10
    log: false
  
  reg_alpha:
    type: "float"
    low: "1e-8"
    high: 10.0
    log: true
  
    reg_lambda:
    type: "float"
    low: "1e-8"
    high: 10.0
    log: true

  scale_pos_weight:
    type: "float"
    low: 50.0
    high: 1000.0
    log: true

  boosting_type:
    type: "categorical"
    choices: ["gbdt", "dart"]

# CatBoost 하이퍼파라미터 검색 범위
catboost_params:
  iterations:
    type: "int"
    low: 100
    high: 1000
    log: false
  
  depth:
    type: "int"
    low: 4
    high: 12
    log: false
  
  learning_rate:
    type: "float"
    low: 0.005
    high: 0.15
    log: true
  
  l2_leaf_reg:
    type: "float"
    low: 0.1
    high: 50.0
    log: true
  
  border_count:
    type: "int"
    low: 32
    high: 128
    log: false
  
  min_data_in_leaf:
    type: "int"
    low: 1
    high: 20
    log: false
  
  max_bin:
    type: "int"
    low: 128
    high: 512
    log: false
  
  subsample:
    type: "float"
    low: 0.6
    high: 1.0
    log: false
  
  od_type:
    type: "categorical"
    choices: ["Iter", "IncToDec"]
  
  od_wait:
    type: "int"
    low: 20
    high: 100
    log: false
  
  bagging_temperature:
    type: "float"
    low: 0.1
    high: 1.0
    log: false
  
  random_strength:
    type: "float"
    low: 0.1
    high: 10.0
    log: true

  # 불균형 데이터 처리 파라미터 (XGBoost와 동일한 범위)
  scale_pos_weight:
    type: "float"
    low: 50.0
    high: 1000.0
    log: true

# Random Forest 하이퍼파라미터 검색 범위
random_forest_params:
  n_estimators:
    type: "int"
    low: 50
    high: 500
    log: false
  
  max_depth:
    type: "int"
    low: 3
    high: 20
    log: false
  
  min_samples_split:
    type: "int"
    low: 2
    high: 20
    log: false
  
  min_samples_leaf:
    type: "int"
    low: 1
    high: 10
    log: false
  
  max_features:
    type: "categorical"
    choices: ["sqrt", "log2", "auto"]
  
  # 불균형 데이터 처리 파라미터 (XGBoost와 동일한 범위)
  class_weight_pos:
    type: "float"
    low: 50.0
    high: 1000.0
    log: true

# 평가 설정
evaluation:
  # 극도 불균형 데이터에 적합한 평가 지표
  primary_metric: "f1"  # F1-Score (Precision과 Recall의 조화평균)
  secondary_metrics: ["recall", "precision", "pr_auc", "balanced_accuracy", "roc_auc"]

# 평가 지표 설정
metrics:
  # 분류 메트릭
  classification_metrics: ["precision", "recall", "f1", "roc_auc", "balanced_accuracy", "pr_auc"]
  
  # 회귀 메트릭
  regression_metrics: ["mae", "rmse", "r2"]
  
  # 교차 검증 메트릭
  cv_metrics: ["accuracy", "f1", "auc", "rmse", "r2", "pr_auc"]

# 결과 저장 설정
save_predictions: true
save_feature_importance: true
save_confusion_matrix: true
save_roc_curve: true
save_precision_recall_curve: true

# 교차 검증 설정
cv:
  strategy: "stratified_group_kfold"  # "group_kfold", "stratified_group_kfold"
  n_folds: 5
  shuffle: false
  stratification:
    enabled: true
    method: "id_based"
    min_positive_samples_per_fold: 1
    balance_threshold: 0.1

# 결과 저장 설정
results:
  save_best_model: true
  model_save_path: "models/best_tuned_model.joblib"
  save_study: true
  study_save_path: "models/optuna_study.pkl"
  create_plots: true
  plots_save_path: "data/tuning_results/"

# MLflow 연동 설정
mlflow:
  experiment_name: "hyperparameter_tuning"
  nested_runs: true
  log_optimization: true 
