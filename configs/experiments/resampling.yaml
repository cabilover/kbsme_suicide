# 리샘플링 실험 설정 파일
# 다양한 리샘플링 기법 비교 실험

# 실험 설정
experiment:
  name: "resampling_experiment"
  description: "다양한 리샘플링 기법 비교 실험 (시계열 특성 고려)"
  tags:
    - "resampling"
    - "imbalanced_data"
    - "smote"
    - "suicide_prediction"
    - "time_series"
    - "temporal_patterns"

# 리샘플링 설정
resampling:
  enabled: true  # 리샘플링 활성화
  method: "smote"  # SMOTE만 사용
  random_state: 42
  
  # 각 기법별 설정
  smote:
    k_neighbors: 3
    sampling_strategy: 0.1
  
  borderline_smote:
    k_neighbors: 5
    sampling_strategy: 0.1  # 극도 불균형 데이터에 적합한 보수적 비율
    m_neighbors: 10
  
  adasyn:
    k_neighbors: 5
    sampling_strategy: 0.1  # 극도 불균형 데이터에 적합한 보수적 비율
    n_neighbors: 5
  
  under_sampling:
    strategy: "random"  # "random", "tomek", "enn"
    sampling_strategy: "auto"
  
  hybrid:
    strategy: "smote_tomek"  # "smote_tomek", "smote_enn"
    smote_k_neighbors: 5
  
  # 시계열 특화 설정
  # 시계열 데이터의 시간적 종속성을 고려한 리샘플링 기법
  # 자살 예측에서 시간적 패턴(계절성, 추세)을 보존하면서 불균형 해결
  time_series_adapted:
    enabled: true  # 시계열 특성 고려 리샘플링 활성화
    time_weight: 0.3  # 시간적 중요도 가중치 (0.0: 무시 ~ 1.0: 완전 고려)
    pattern_preservation: true  # 시간적 패턴 보존
    temporal_window: 3  # 시간적 윈도우 크기 (개월 단위)
    seasonality_weight: 0.2  # 계절성 가중치 (월별/계절별 패턴 고려)
    trend_preservation: true  # 추세 패턴 보존 (장기적 변화 패턴 유지)

# 모델별 리샘플링 설정
model_specific:
  xgboost:
    # 기존 XGBoost 설정 유지
    scale_pos_weight: 1.0
    use_focal_loss: true
    
  catboost:
    class_weights: null
    auto_class_weights: null
    scale_pos_weight: 1.0
    
  lightgbm:
    class_weight: null
    scale_pos_weight: 1.0
    is_unbalance: false  # scale_pos_weight와 충돌 방지
    
  random_forest:
    class_weight: null
    sample_weight: null

# 하이퍼파라미터 튜닝 설정
tuning:
  n_trials: 100  # 빠른 테스트용
  direction: "maximize"
  primary_metric: "pr_auc"
  n_jobs: 4
  
  # 조기 종료 설정
  early_stopping:
    enabled: true
    patience: 20  # 10번 연속 개선 없으면 조기 종료
    min_trials: 20  # 최소 5번은 시도

# Optuna Sampler 설정
sampler:
  type: "tpe"  # "tpe", "random", "cmaes", "nsgaii", "qmc"
  
  # TPE 설정
  tpe:
    n_startup_trials: 3  # 초기 랜덤 시도 횟수
    n_ei_candidates: 24  # EI 계산 후보 수
    multivariate: true   # 다변량 TPE 사용
    group: true          # 그룹화된 파라미터 지원

# XGBoost 하이퍼파라미터 검색 범위 (리샘플링에 최적화)
xgboost_params:
  n_estimators:
    type: "int"
    low: 50
    high: 300
    log: false
  
  max_depth:
    type: "int"
    low: 3
    high: 10
    log: false
  
  learning_rate:
    type: "float"
    low: 0.01
    high: 0.3
    log: true
  
  subsample:
    type: "float"
    low: 0.6
    high: 1.0
    log: false
  
  colsample_bytree:
    type: "float"
    low: 0.6
    high: 1.0
    log: false
  
  min_child_weight:
    type: "int"
    low: 1
    high: 10
    log: false
  
  reg_alpha:
    type: "float"
    low: 1e-8
    high: 10.0
    log: true
  
  reg_lambda:
    type: "float"
    low: 1e-8
    high: 10.0
    log: true
  
  scale_pos_weight:
    type: "float"
    low: 0.8
    high: 3.0
    log: true
  
  use_focal_loss:
    type: "categorical"
    choices: [true, false]
  
  focal_loss_alpha:
    type: "float"
    low: 0.1
    high: 0.9
    log: false
  
  focal_loss_gamma:
    type: "float"
    low: 0.5
    high: 5.0
    log: false
  
  # 리샘플링 관련 하이퍼파라미터
  smote_sampling_strategy:
    type: "float"
    low: 0.05
    high: 0.3
    log: false
  
  borderline_smote_sampling_strategy:
    type: "float"
    low: 0.05
    high: 0.3
    log: false
  
  adasyn_sampling_strategy:
    type: "float"
    low: 0.05
    high: 0.3
    log: false
  
  # 시계열 특화 리샘플링 하이퍼파라미터
  time_weight:
    type: "float"
    low: 0.1
    high: 0.8
    log: false
  
  temporal_window:
    type: "int"
    low: 1
    high: 6
    log: false
  
  seasonality_weight:
    type: "float"
    low: 0.0
    high: 0.5
    log: false
  
  pattern_preservation:
    type: "categorical"
    choices: [true, false]
  
  trend_preservation:
    type: "categorical"
    choices: [true, false]
  
  # k-neighbors 하이퍼파라미터 (SMOTE, Borderline SMOTE, ADASYN 공통)
  smote_k_neighbors:
    type: "int"
    low: 3
    high: 10
    log: false
  
  borderline_smote_k_neighbors:
    type: "int"
    low: 3
    high: 10
    log: false
  
  adasyn_k_neighbors:
    type: "int"
    low: 3
    high: 10
    log: false

# CatBoost 하이퍼파라미터 검색 범위 추가
catboost_params:
  iterations:
    type: "int"
    low: 50
    high: 500
    log: false
  
  depth:
    type: "int"
    low: 3
    high: 10
    log: false
  
  learning_rate:
    type: "float"
    low: 0.01
    high: 0.3
    log: true
  
  l2_leaf_reg:
    type: "float"
    low: 1
    high: 10
    log: true
  
  border_count:
    type: "int"
    low: 32
    high: 255
    log: false
  
  bagging_temperature:
    type: "float"
    low: 0.0
    high: 1.0
    log: false
  
  random_strength:
    type: "float"
    low: 0.1
    high: 10.0
    log: true

# LightGBM 하이퍼파라미터 검색 범위 추가
lightgbm_params:
  n_estimators:
    type: "int"
    low: 50
    high: 300
    log: false
  
  max_depth:
    type: "int"
    low: 3
    high: 10
    log: false
  
  learning_rate:
    type: "float"
    low: 0.01
    high: 0.3
    log: true
  
  num_leaves:
    type: "int"
    low: 10
    high: 100
    log: false
  
  subsample:
    type: "float"
    low: 0.6
    high: 1.0
    log: false
  
  colsample_bytree:
    type: "float"
    low: 0.6
    high: 1.0
    log: false
  
  reg_alpha:
    type: "float"
    low: 1e-8
    high: 10.0
    log: true
  
  reg_lambda:
    type: "float"
    low: 1e-8
    high: 10.0
    log: true

# Random Forest 하이퍼파라미터 검색 범위 추가
random_forest_params:
  n_estimators:
    type: "int"
    low: 50
    high: 300
    log: false
  
  max_depth:
    type: "int"
    low: 3
    high: 20
    log: false
  
  min_samples_split:
    type: "int"
    low: 2
    high: 20
    log: false
  
  min_samples_leaf:
    type: "int"
    low: 1
    high: 10
    log: false
  
  max_features:
    type: "categorical"
    choices: ["sqrt", "log2", "None"]
  
  bootstrap:
    type: "categorical"
    choices: [true, false]

# 평가 지표 설정 (불균형 데이터에 최적화)
evaluation:
  # 극도 불균형 데이터에 적합한 평가 지표
  primary_metric: "pr_auc"  # Precision-Recall AUC (불균형 데이터에 적합)
  secondary_metrics: ["recall", "precision", "balanced_accuracy", "roc_auc"]
  optimization_direction: "maximize"  # 하이퍼파라미터 튜닝 최적화 방향
  
  # 교차 검증 설정
  cv:
    strategy: "group_kfold"
    n_folds: 5
    shuffle: false

# 결과 저장 설정
results:
  save_best_model: true
  model_save_path: "models/best_resampling_tuned_model.joblib"
  save_study: true
  study_save_path: "models/resampling_optuna_study.pkl"
  create_plots: true
  plots_save_path: "data/resampling_tuning_results/"

# MLflow 연동 설정
mlflow:
  experiment_name: "resampling_hyperparameter_tuning"
  nested_runs: true
  log_comparison: true 