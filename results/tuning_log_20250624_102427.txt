2025-06-24 10:24:27,839 - src.hyperparameter_tuning - INFO - MLflow 실험 설정: hyperparameter_tuning (ID: 765186397364671153)
2025-06-24 10:24:27,840 - src.hyperparameter_tuning - INFO - 전달받은 데이터 사용: (85094, 33)
2025-06-24 10:24:27,840 - src.hyperparameter_tuning - INFO - 모델 타입: xgboost
2025-06-24 10:24:27,840 - src.hyperparameter_tuning - INFO - 튜닝 설정 - 시도 횟수: 1, 타임아웃: 3600초
2025-06-24 10:24:27,840 - src.hyperparameter_tuning - INFO - 하이퍼파라미터 튜너 초기화 완료
2025-06-24 10:24:27,840 - src.hyperparameter_tuning - INFO -   - 튜닝 설정: {'data': {'file_path': 'data/processed/processed_data_with_features.csv', 'encoding': 'utf-8', 'na_values': ['', 'nan', 'NaN', 'NULL', 'null']}, 'features': {'target_columns': ['suicide_a_next_year'], 'exclude_columns': ['id', 'patient_id', 'visit_date', 'visit_year'], 'categorical_columns': ['gender', 'marital_status', 'education_level', 'income_level', 'residence_type', 'insurance_type', 'primary_diagnosis', 'comorbidity', 'medication_type', 'treatment_type', 'follow_up_status'], 'selected_features': ['age', 'sex', 'comp', 'anxiety_score', 'depress_score', 'sleep_score'], 'validation': {'scope': 'sample', 'sample_size': 10}, 'enable_feature_engineering': False, 'enable_lagged_features': False, 'lag_periods': [1, 2, 3], 'lagged_features': {'columns': ['anxiety_score', 'depress_score', 'sleep_score', 'comp']}, 'enable_rolling_stats': False, 'rolling_stats': {'window_sizes': [2, 3], 'columns': ['anxiety_score', 'depress_score', 'sleep_score', 'comp']}}, 'preprocessing': {'time_series_imputation': {'columns': ['anxiety_score', 'depress_score', 'sleep_score', 'comp'], 'fallback_strategy': 'mean'}, 'numerical_imputation': {'strategy': 'mean', 'columns': ['anxiety_score', 'depress_score', 'sleep_score', 'comp', 'age']}, 'categorical_imputation': {'strategy': 'most_frequent', 'columns': ['sex']}, 'categorical_encoding': {'method': 'ordinal'}, 'missing_value_strategy': 'median', 'outlier_detection': {'method': 'iqr', 'threshold': 1.5}, 'scaling': {'method': 'robust', 'with_mean': True, 'with_std': True}, 'feature_selection': {'method': 'variance_threshold', 'threshold': 0.01}}, 'data_split': {'test_ids_ratio': 0.15, 'random_state': 42, 'method': 'stratified_kfold', 'n_splits': 5, 'test_size': 0.2, 'val_size': 0.2}, 'validation': {'strategy': 'group_kfold', 'num_cv_folds': 3, 'test_size': 0.15, 'random_state': 42, 'val_ids_ratio': 0.15, 'validation_start_year': 2021, 'min_train_years': 3, 'max_train_years': 8}, 'time_series': {'date_column': 'dov', 'year_column': 'yov', 'id_column': 'id'}, 'evaluation': {'regression_metrics': ['mae', 'rmse', 'r2'], 'classification_metrics': ['precision', 'recall', 'f1', 'roc_auc', 'balanced_accuracy'], 'cv_metrics': ['accuracy', 'f1', 'auc', 'rmse', 'r2'], 'save_predictions': True, 'save_feature_importance': True, 'save_confusion_matrix': True, 'save_roc_curve': True, 'save_precision_recall_curve': True, 'primary_metric': 'pr_auc', 'secondary_metrics': ['recall', 'precision', 'balanced_accuracy', 'roc_auc'], 'metrics': {'classification_metrics': ['precision', 'recall', 'f1', 'roc_auc', 'balanced_accuracy', 'pr_auc'], 'regression_metrics': ['mae', 'rmse', 'r2'], 'cv_metrics': ['accuracy', 'f1', 'auc', 'rmse', 'r2', 'pr_auc']}}, 'training': {'early_stopping': True, 'patience': 10, 'handle_imbalance': True, 'save_best_model': True, 'model_save_path': 'models/'}, 'logging': {'log_splits_info': True, 'log_fold_details': True, 'level': 'INFO', 'format': '%(asctime)s - %(name)s - %(levelname)s - %(message)s', 'file': 'logs/experiment.log'}, 'output': {'directory': 'results', 'save_model': True, 'save_predictions': True, 'save_feature_importance': True, 'save_confusion_matrix': True, 'save_roc_curve': True, 'save_precision_recall_curve': True}, 'mlflow': {'experiment_name': 'hyperparameter_tuning', 'experiment_description': '자살 위험 예측 모델 실험', 'tags': ['suicide_prediction', 'healthcare', 'classification', 'regression'], 'nested_runs': True, 'save_artifacts': True, 'log_params': True, 'log_metrics': True, 'log_model': True, 'tracking': {'tracking_uri': 'file:./mlruns', 'experiment_name': 'suicide_prediction', 'nested_runs': True, 'artifact_location': './mlruns'}, 'logging': {'param_logging_level': 'INFO', 'metric_logging_level': 'INFO', 'artifact_logging_level': 'INFO', 'log_experiment_info': True, 'log_fold_results': True, 'log_model_info': True}, 'log_optimization': True}, 'model': {'model_type': 'xgboost', 'xgboost': {'n_estimators': 100, 'max_depth': 6, 'learning_rate': 0.1, 'subsample': 0.8, 'colsample_bytree': 0.8, 'min_child_weight': 1, 'scale_pos_weight': 1.0, 'early_stopping_rounds': 10, 'verbose': 0, 'n_jobs': 28, 'use_focal_loss': False, 'focal_loss': {'alpha': 0.25, 'gamma': 2.0}}}, 'resampling': {'enabled': False, 'method': 'smote', 'random_state': 42, 'smote_k_neighbors': 5, 'borderline_smote_k_neighbors': 5, 'adasyn_k_neighbors': 5, 'under_sampling_strategy': 'random', 'hybrid_strategy': 'smote_tomek', 'time_series_adapted': {'enabled': False, 'time_weight': 0.3, 'pattern_preservation': True}}, 'experiment': {'name': 'hyperparameter_tuning_experiment', 'description': 'Optuna 기반 하이퍼파라미터 최적화 실험', 'tags': ['hyperparameter_tuning', 'optuna', 'optimization']}, 'tuning': {'direction': 'maximize', 'n_trials': 1, 'n_jobs': 1, 'early_stopping': {'enabled': True, 'patience': 20, 'min_trials': 30}}, 'sampler': {'type': 'tpe', 'tpe': {'n_startup_trials': 10, 'n_ei_candidates': 24, 'multivariate': True, 'group': False}, 'cmaes': {'x0': {'n_estimators': 100, 'max_depth': 6, 'learning_rate': 0.1, 'subsample': 0.8, 'colsample_bytree': 0.8, 'min_child_weight': 1, 'reg_alpha': 0.1, 'reg_lambda': 1.0}, 'sigma0': 0.1}}, 'xgboost_params': {'n_estimators': {'type': 'int', 'low': 50, 'high': 1000, 'log': False}, 'max_depth': {'type': 'int', 'low': 3, 'high': 15, 'log': False}, 'learning_rate': {'type': 'float', 'low': 0.01, 'high': 0.3, 'log': True}, 'subsample': {'type': 'float', 'low': 0.6, 'high': 1.0, 'log': False}, 'colsample_bytree': {'type': 'float', 'low': 0.6, 'high': 1.0, 'log': False}, 'min_child_weight': {'type': 'int', 'low': 1, 'high': 10, 'log': False}, 'reg_alpha': {'type': 'float', 'low': '1e-8', 'high': 10.0, 'log': True}, 'reg_lambda': {'type': 'float', 'low': '1e-8', 'high': 10.0, 'log': True}, 'scale_pos_weight': {'type': 'float', 'low': 0.5, 'high': 10.0, 'log': True}}, 'lightgbm_params': {'n_estimators': {'type': 'int', 'low': 50, 'high': 1000, 'log': False}, 'max_depth': {'type': 'int', 'low': 3, 'high': 12, 'log': False}, 'learning_rate': {'type': 'float', 'low': 0.01, 'high': 0.3, 'log': True}, 'subsample': {'type': 'float', 'low': 0.6, 'high': 1.0, 'log': False}, 'colsample_bytree': {'type': 'float', 'low': 0.6, 'high': 1.0, 'log': False}, 'min_child_weight': {'type': 'int', 'low': 1, 'high': 10, 'log': False}, 'reg_alpha': {'type': 'float', 'low': '1e-8', 'high': 10.0, 'log': True}, 'reg_lambda': {'type': 'float', 'low': '1e-8', 'high': 10.0, 'log': True}}, 'catboost_params': {'iterations': {'type': 'int', 'low': 50, 'high': 500, 'log': False}, 'depth': {'type': 'int', 'low': 3, 'high': 10, 'log': False}, 'learning_rate': {'type': 'float', 'low': 0.01, 'high': 0.3, 'log': True}, 'l2_leaf_reg': {'type': 'float', 'low': 1, 'high': 10, 'log': True}, 'border_count': {'type': 'int', 'low': 32, 'high': 255, 'log': False}, 'bagging_temperature': {'type': 'float', 'low': 0.1, 'high': 1.0, 'log': False}, 'random_strength': {'type': 'float', 'low': 0.1, 'high': 10.0, 'log': True}}, 'random_forest_params': {'n_estimators': {'type': 'int', 'low': 50, 'high': 500, 'log': False}, 'max_depth': {'type': 'int', 'low': 3, 'high': 20, 'log': False}, 'min_samples_split': {'type': 'int', 'low': 2, 'high': 20, 'log': False}, 'min_samples_leaf': {'type': 'int', 'low': 1, 'high': 10, 'log': False}, 'max_features': {'type': 'categorical', 'choices': ['sqrt', 'log2', 'auto']}}, 'cv': {'strategy': 'group_kfold', 'n_folds': 5, 'shuffle': False}, 'results': {'save_best_model': True, 'model_save_path': 'models/best_tuned_model.joblib', 'save_study': True, 'study_save_path': 'models/optuna_study.pkl', 'create_plots': True, 'plots_save_path': 'data/tuning_results/'}}
2025-06-24 10:24:27,840 - src.hyperparameter_tuning - INFO -   - 튜닝 횟수: 1
2025-06-24 10:24:27,840 - src.hyperparameter_tuning - INFO -   - 타임아웃: 3600초
2025-06-24 10:24:27,876 - __main__ - INFO - MLflow Run 시작: a45072c42f76439f88b881610c568745
2025-06-24 10:24:27,879 - __main__ - INFO - 튜닝 파라미터 로깅 완료: 6개 파라미터
2025-06-24 10:24:27,879 - src.hyperparameter_tuning - INFO - 하이퍼파라미터 최적화 시작
2025-06-24 10:24:27,884 - src.hyperparameter_tuning - INFO - Trial 0: 모델 타입 = xgboost
2025-06-24 10:24:27,884 - src.hyperparameter_tuning - ERROR - Trial 0 실패: Invalid file path or buffer object type: <class 'NoneType'>
2025-06-24 10:24:27,889 - src.hyperparameter_tuning - WARNING - 유효하지 않은 best_score: -inf
2025-06-24 10:24:27,889 - src.hyperparameter_tuning - INFO - 최적화 완료!
2025-06-24 10:24:27,889 - src.hyperparameter_tuning - INFO -   - 최고 성능: -inf
2025-06-24 10:24:27,889 - src.hyperparameter_tuning - INFO -   - 최적 파라미터: {'n_estimators': 406, 'max_depth': 15, 'learning_rate': 0.1205712628744377, 'subsample': 0.8394633936788146, 'colsample_bytree': 0.6624074561769746, 'min_child_weight': 2, 'reg_alpha': 3.3323645788192616e-08, 'reg_lambda': 0.6245760287469893, 'scale_pos_weight': 3.027182927734624}
2025-06-24 10:24:27,889 - __main__ - ERROR - 결과 저장 실패: Invalid file path or buffer object type: <class 'NoneType'>
2025-06-24 10:24:27,889 - __main__ - INFO - 최고 성능: -inf
2025-06-24 10:24:27,889 - __main__ - INFO - 최적 파라미터:
2025-06-24 10:24:27,889 - __main__ - INFO -   n_estimators: 406
2025-06-24 10:24:27,889 - __main__ - INFO -   max_depth: 15
2025-06-24 10:24:27,889 - __main__ - INFO -   learning_rate: 0.1205712628744377
2025-06-24 10:24:27,889 - __main__ - INFO -   subsample: 0.8394633936788146
2025-06-24 10:24:27,889 - __main__ - INFO -   colsample_bytree: 0.6624074561769746
2025-06-24 10:24:27,889 - __main__ - INFO -   min_child_weight: 2
2025-06-24 10:24:27,889 - __main__ - INFO -   reg_alpha: 3.3323645788192616e-08
2025-06-24 10:24:27,889 - __main__ - INFO -   reg_lambda: 0.6245760287469893
2025-06-24 10:24:27,889 - __main__ - INFO -   scale_pos_weight: 3.027182927734624

==================================================
튜닝 결과 요약
==================================================
모델 타입: xgboost
실험 타입: hyperparameter_tuning
사용 데이터 행 수: 100,000
MLflow 링크: http://localhost:5000/#/experiments/765186397364671153/runs/a45072c42f76439f88b881610c568745
최고 성능: -inf
최적 파라미터: {'n_estimators': 406, 'max_depth': 15, 'learning_rate': 0.1205712628744377, 'subsample': 0.8394633936788146, 'colsample_bytree': 0.6624074561769746, 'min_child_weight': 2, 'reg_alpha': 3.3323645788192616e-08, 'reg_lambda': 0.6245760287469893, 'scale_pos_weight': 3.027182927734624}
튜닝 시간: N/A
==================================================
2025-06-24 10:24:27,889 - __main__ - INFO - 실험 결과가 /home/junhyung/Documents/simcare/kbsmc_suicide/results/experiment_results_20250624_102427.txt에 저장되었습니다.
2025-06-24 10:24:27,889 - __main__ - INFO - MLflow Experiment ID: 765186397364671153
2025-06-24 10:24:27,889 - __main__ - INFO - MLflow Run ID: a45072c42f76439f88b881610c568745
2025-06-24 10:24:27,889 - __main__ - INFO - MLflow 링크: http://localhost:5000/#/experiments/765186397364671153/runs/a45072c42f76439f88b881610c568745
